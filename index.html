<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>js-2d-game</title>
    <link rel="stylesheet" href="reset.css">
    <style>
        #canvas {
            background-color: #91b493;
            display: block;
            margin: 0 auto;
            opacity: .5;
        }
        button {
            border-radius: 5px;
            background-color: #a4a4a4;
            color: #fff;
            display: block;
            margin: 10px auto 0;
            padding: 8px 0;
            text-align: center;
            transition: opacity .3s ease;
            width: 100px;
        }
        button:hover {
            opacity: .8;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="1000" height="600"></canvas>
    <button onclick="gameStart()">スタート</button>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const unicorn = new Image(); // ユニコーン
        unicorn.src = './image/unicorn.png';
        const stone = new Image(); // 石を複数別の物を表示したい場合、Stoneクラスに入れる。
        stone.src = './image/stone.png';
        const bg = new Image(); // 背景
        bg.src = './image/bg_natural_sougen.jpg';

        let x = 1000;
        let y = 450;

        let stones = [];
        class Stone {
            constructor(x) {
                this.x = x;
                stones.push(this);
            }

            move() {
                this.x = this.x - 10;
                ctx.drawImage(stone, this.x, 450, 100, 100);

                // TODO: キャラと石が当たっているか判定
                // キャラの座標と石の座標が重なるかで判定
            }
        }

        for (let i = 1; i <= 5; i++) {
            new Stone(200 * i);
        }

        function draw() {
            ctx.clearRect(0, 0, 1000, 600);
            ctx.drawImage(bg, 0, 0, 1000, 600);
            ctx.drawImage(unicorn, 100, y, 80, 80);

            stones.forEach((stone, i) => {
                stone.move();
            })
        }

        // TODO スタートボタン作る
        function gameStart() {
            canvas.style.opacity = 1;
            setInterval(draw, 100);
            
            window.onkeydown = (event) => {
                // TODO ユニコーンclass作成, jumpメソッド作成
                // ジャンプをなめらかに
                if (event.code === 'ArrowUp') {
                    y = y - 10;
                    ctx.drawImage(unicorn, 100, y, 80, 80);
                } else if (event.code === 'ArrowDown') {
                    y = y + 10;
                    ctx.drawImage(unicorn, 100, y, 80, 80);
                }
            };
        }

        window.onload = () => {
            ctx.drawImage(bg, 0, 0, 1000, 600);
            ctx.drawImage(unicorn, 100, y, 80, 80);
        }

        // 追加機能例
        // 無敵アイテム
        // 石が増える
    </script>
</body>
</html>